(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var n=e.n(t);window.wp.util,window.window.Backbone,window._["."],window.window.serializeJSON,window.wp.wpColorPickerAlpha,function(e){_.mixin({escapeHtml:function(e){return e.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'")},getFormData:function(e){return e.serializeJSON()}});var t=Backbone.Model.extend({defaults:{access_token:""}}),n=Backbone.View.extend({events:{"change input":"enable","click .media-modal-close":"close","submit .media-modal-form":"submit"},templates:{},initialize:function(){_.bindAll(this,"open","render","close","enable","submit"),this.init(),this.open()},init:function(){this.templates.window=wp.template("qlttf-modal-account-main")},render:function(){var e=this;e.$el.html(e.templates.window(e.model.attributes))},updateModel:function(e){e.preventDefault();var t=this.$el.find("form"),n=_.getFormData(t);this.model.set(n)},enable:function(t){e(".media-modal-submit").prop("disabled",!1),this.updateModel(t)},open:function(t){this.render(),e("body").addClass("modal-open").append(this.$el)},close:function(t){t.preventDefault(),this.undelegateEvents(),e(document).off("focusin"),e("body").removeClass("modal-open"),this.remove()},submit:function(t){t.preventDefault();let n=e(t.target).find(".media-modal-submit"),a=e("#refresh_token").val(),i=n.closest(".media-toolbar").find(".spinner");e.ajax({url:ajaxurl,type:"post",data:{action:"qlttf_add_account_by_rft",account_rft:a,nonce:qlttf_account.nonce.qlttf_add_account_by_rft},beforeSend:function(){n.prop("disabled",!0),i.addClass("is-active")},success:function(e){alert(e.data),e.success?setTimeout((function(){window.location.reload()}),300):alert(e.data)},complete:function(){i.removeClass("is-active")},error:function(e,t){console.log(t)}})}}),a=Backbone.View.extend({initialize:function(e){var a=new t;a.set({access_token:""}),new n({model:a})}});e(document).on("click","[data-qlttf-copy-token]",(function(t){t.preventDefault(),e(e(this).data("qlttf-copy-token")).select(),document.execCommand("copy")})),e(document).on("click","[data-qlttf-delete-token]",(function(t){if(t.preventDefault(),!confirm(qlttf_account.message.confirm_delete))return!1;var n=e(t.target).closest("[data-account_id]").data("account_id"),a=e(t.target).closest("td").find(".spinner");e.ajax({url:ajaxurl,type:"post",data:{action:"qlttf_delete_account",account_id:n,nonce:qlttf_account.nonce.qlttf_delete_account},beforeSend:function(){a.addClass("is-active")},success:function(e){console.log(e),e.success?setTimeout((function(){window.location.reload()}),300):alert(e.data)},complete:function(){a.removeClass("is-active")},error:function(e,t){console.log(t)}})})),e(document).on("click","[data-qlttf-renew-token]",(function(t){t.preventDefault();var n=e(t.target).closest("[data-account_id]").data("account_id"),a=e(t.target).closest("td").find(".spinner");e.ajax({url:ajaxurl,type:"post",data:{action:"qlttf_renew_access_token",account_id:n,nonce:qlttf_account.nonce.qlttf_renew_access_token},beforeSend:function(){a.addClass("is-active")},success:function(e){alert(e.data),e.success?(setTimeout((function(){window.location.reload()}),300),console.log(e)):alert(e.data)},complete:function(){a.removeClass("is-active")},error:function(e,t){console.log(t)}})})),e("#qlttf-add-token").on("click",(function(e){e.preventDefault(),new a(e)}))}(n()),function(e){var t,n=0,a=function(){e("#qlttf_modal").removeClass("processing")};_.mixin({escapeHtml:function(e){return e.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'")},getFormDataFix:function(e){return e.serializeJSON({checkboxUncheckedValue:"false",parseBooleans:!0,parseNulls:!0})}});var i=Backbone.Model.extend({defaults:qlttf_feed.args}),o=Backbone.View.extend({templates:{},initialize:function(){this.templates.window=wp.template("qlttf-modal-tabs")},render:function(){this.model.attributes.panel="tab_panel_feed",this.$el.html(this.templates.window(this.model.attributes))}}),l=Backbone.View.extend({templates:{},initialize:function(){this.templates.window=wp.template("qlttf-modal-panels")},render:function(){this.$el.html(this.templates.window(this.model.attributes)),this.$el.trigger("qlttf-enhanced-color")}}),s=Backbone.View.extend({events:{"change input":"enable","change textarea":"enable","change select":"enable","click .media-modal-image":"setLayout","click .media-modal-backdrop":"close","click .media-modal-close":"close","click .media-modal-prev":"edit","click .media-modal-next":"edit","click .media-modal-tab":"tab","change .media-modal-render-tabs":"renderTabs","change .media-modal-render-panels":"renderPanels","submit .media-modal-form":"submit","qlttf.color.change input":"enable"},templates:{},initialize:function(){_.bindAll(this,"open","tab","edit","change","load","render","close","submit"),this.init(),this.open()},init:function(){this.templates.window=wp.template("qlttf-modal-main")},assign:function(e,t){e.setElement(this.$(t)).render()},render:function(){var e=this;e.$el.html(e.templates.window(e.model.attributes)),this.tabs=new o({model:e.model}),this.panels=new l({model:e.model}),this.assign(this.tabs,"#qlttf-modal-tabs"),this.assign(this.panels,"#qlttf-modal-panels"),_.delay((function(){e.$el.trigger("qlttf-enhanced-color")}),100)},load:function(){var t=this;if(t.$el.find("#qlttf_modal"),null!=t.model.attributes.id){var n=parseInt(e("#qlttf_feeds_table tr[data-feed_id="+t.model.get("id")+"]").data("feed_position"));e.ajax({url:ajaxurl,data:{action:"qlttf_edit_feed",nonce:qlttf_feed.nonce.qlttf_edit_feed,feed_id:this.model.attributes.id},dataType:"json",type:"POST",beforeSend:function(){},complete:function(){qlttf_feed.accounts[t.model.attributes.open_id]||(t.enable(),alert(qlttf_feed.message.save)),a()},error:function(){alert("Error!")},success:function(e){e.success?(t.model.set(e.data),t.model.set({order:n}),t.render()):alert(e.data)}})}else t.render()},edit:function(a){a.preventDefault();var i=this,o=e(a.target),l=parseInt(e("#qlttf_feeds_table tr[data-feed_id]").length),s=parseInt(e("#qlttf_feeds_table tr[data-feed_id="+i.model.get("id")+"]").data("feed_position"));n++,t&&clearTimeout(t),t=setTimeout((function(){s=o.hasClass("media-modal-next")?Math.min(s+n,l):Math.max(s-n,1),i.model.set({id:parseInt(e("#qlttf_feeds_table tr[data-feed_position="+s+"]").data("feed_id"))}),n=0,i.load()}),300)},open:function(t){var n=this;e("body").addClass("modal-open").append(this.$el),null!=n.model.attributes.id?this.load():_.delay((function(){a(),n.setUsername()}),100)},setLayout:function(t){t.preventDefault(),t.stopPropagation(),e(t.target).find("input[type=radio]").prop("checked",!0),e(t.target).siblings().find("input[type=radio]").prop("checked",!1),this.updateModel(t),this.renderPanels(t),this.renderTabs(t),this.enable(t)},setUsername:function(e){this.$el.find("#qlttf_modal").find("form").find("select[name=username]").trigger("change")},updateModel:function(e){e&&e.preventDefault();var t=this.$el.find("#qlttf_modal").find("form"),n=_.getFormDataFix(t);this.model.set(n)},tab:function(t){t.preventDefault();var n=this.$el.find("#qlttf_modal"),a=e(t.currentTarget),i=n.find("ul.qlttf-tabs"),o=a.find("a").attr("href").replace("#","");i.find(".active").removeClass("active"),a.addClass("active"),this.model.attributes.panel=o,this.model.changed.panel=o,this.renderPanels(t)},renderTabs:function(e){this.renderPanels(e),this.tabs.render()},renderPanels:function(e){this.updateModel(e),this.panels.render()},change:function(e){e.preventDefault(),this.updateModel(e)},reload:function(e){this.$el.find("#qlttf_modal").hasClass("reload")?location.reload():this.remove()},close:function(t){t.preventDefault(),this.undelegateEvents(),e(document).off("focusin"),e("body").removeClass("modal-open"),this.$el.find("#qlttf_modal").addClass("reload"),this.reload(t)},enable:function(t){e(".media-modal-submit").prop("disabled",!1),this.updateModel(t)},submit:function(t){t.preventDefault();var n=this,a=n.$el.find("#qlttf_modal"),i=a.find(".settings-save-status .spinner"),o=a.find(".settings-save-status .saved");return e.ajax({url:ajaxurl,data:{action:"qlttf_save_feed",nonce:qlttf_feed.nonce.qlttf_save_feed,feed:JSON.stringify(n.model.attributes)},dataType:"json",type:"POST",beforeSend:function(){e(".media-modal-submit").prop("disabled",!0),i.addClass("is-active")},complete:function(){o.addClass("is-active"),i.removeClass("is-active"),_.delay((function(){o.removeClass("is-active")}),1e3)},error:function(e){alert("Error!")},success:function(e){e.success?null==n.model.attributes.id&&(a.addClass("reload"),n.reload(t),n.close(t)):alert(e.data)}}),!1}}),d=Backbone.View.extend({initialize:function(t){var n=e(t.target).closest("[data-feed_position]").data("feed_id"),a=new i;a.set({id:n}),a.set({open_id:Object.keys(qlttf_feed.accounts)[0]}),new s({model:a}).render()}});e(document).on("qlttf-enhanced-color",(function(t){e(".color-picker").filter(":not(.enhanced)").each((function(){e(this).is("[readonly]")&&e(this).parent(".form-field").addClass("disabled-field"),e(this).wpColorPicker({change:function(t,n){console.log("wpColorPicker"),e(t.target).trigger("qlttf.color.change")}})}))})),e("#qlttf-add-feed").on("click",(function(e){e.preventDefault(),new d(e)}));var c=!1;e(".qlttf_edit_feed").on("click",(function(e){e.preventDefault(),c||(new d(e),c=!0)})),e(".qlttf_delete_feed").on("click",(function(t){if(t.preventDefault(),!confirm(qlttf_feed.message.confirm_delete))return!1;var n=e(t.target),a=n.parent().find(".spinner"),i=n.closest("[data-feed_id]").data("feed_id");e.ajax({url:ajaxurl,data:{action:"qlttf_delete_feed",nonce:qlttf_feed.nonce.qlttf_delete_feed,feed_id:i},dataType:"json",type:"POST",beforeSend:function(){a.addClass("is-active")},complete:function(){a.removeClass("is-active")},error:function(e){},success:function(e){e.data?location.reload():alert(e.data)}})})),e(".qlttf_clear_cache").on("click",(function(t){if(t.preventDefault(),!confirm(qlttf_feed.message.confirm_clear_cache))return!1;var n=e(t.target),a=n.parent().find(".spinner"),i=n.closest("[data-feed_id]").data("feed_id"),o=n.closest("[data-feed_open_id]").data("feed_open_id");e.ajax({url:ajaxurl,type:"post",data:{action:"qlttf_clear_cache",feed_id:i,nonce:qlttf_feed.nonce.qlttf_clear_cache,open_id:o},beforeSend:function(){a.addClass("is-active")},success:function(e){e.success?setTimeout((function(){a.removeClass("is-active")}),300):alert(e.data)},complete:function(){setTimeout((function(){a.removeClass("is-active")}),600)},error:function(e,t){console.log(t)}})})),e(document).on("click","[data-qlttf-copy-feed-shortcode]",(function(t){t.preventDefault(),e(e(this).data("qlttf-copy-feed-shortcode")).select(),document.execCommand("copy")}))}(n()),function(e){function t(t){if(t){if(e("#qlttf-save-settings .tiktok-feed-spinner img").length)e("#qlttf-save-settings .tiktok-feed-spinner img").attr("src",t);else{var n='<img src="'+t+'" class="ig-spin" />';e("#qlttf-save-settings .tiktok-feed-spinner").append(n)}e("#qlttf-save-settings .tiktok-feed-spinner .ig-spin").hide(),e("#qlttf-save-settings .tiktok-feed-spinner img").show()}else e("#qlttf-save-settings .tiktok-feed-spinner .ig-spin").show(),e("#qlttf-save-settings .tiktok-feed-spinner img").remove()}_.mixin({escapeHtml:function(e){return e.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'")},getFormData:function(e){return e.serializeJSON()}});var n=e("input[name=spinner_id]"),a=e("#ig-spinner-reset");e("#qlttf-save-settings").on("submit",(function(t){t.preventDefault();var n=e(this),a=n.find(".spinner");e.ajax({url:ajaxurl,type:"post",dataType:"JSON",data:{action:"qlttf_save_settings",nonce:qlttf_settings.nonce.qlttf_save_settings,settings_data:n.serialize()},beforeSend:function(){a.addClass("is-active")},success:function(e){},complete:function(){a.removeClass("is-active")},error:function(e,t){console.log(t)}})})),a.on("click",(function(){n.val(""),t(),e(this).hide()})),""==n.val()&&a.hide(),""!=n.data("misrc")&&t(n.data("misrc")),e("#ig-spinner-upload").on("click",(function(e){var i;e.preventDefault(),i&&i.open(),(i=wp.media({title:"Select Media",multiple:!1,library:{type:"image"}})).on("close",(function(){var e=i.state().get("selection");if(e.length){var o,l=new Array,s=0;e.each((function(e){l[s]=e.id,o=e.attributes.url,s++}));var d=l.join(",");n.val(d),t(o)}""==n.val()?a.hide():a.show()})),i.on("open",(function(){var e=i.state().get("selection");n.val().split(",").forEach((function(t){let n=wp.media.attachment(t);n.fetch(),e.add(n?[n]:[])}))})),i.open()}))}(n())})();